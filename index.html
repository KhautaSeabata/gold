<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mzanzi FX - Forex Trading</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Rajdhani', -apple-system, sans-serif;
            background: linear-gradient(135deg, #000 0%, #0a0a0a 25%, #1a1a1a 50%, #0a0a0a 75%, #000 100%);
            background-attachment: fixed; color: white; overflow: hidden; height: 100vh; width: 100vw; position: fixed;
        }
        .app-container { position: relative; z-index: 2; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .header {
            background: linear-gradient(180deg, rgba(0,0,0,0.95) 0%, rgba(26,26,30,0.95) 100%);
            padding: 6px 10px; border-bottom: 2px solid transparent;
            border-image: linear-gradient(90deg, #00ff00 0%, #0066ff 50%, #ff0000 100%);
            border-image-slice: 1; backdrop-filter: blur(10px); flex-shrink: 0;
        }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
        .logo {
            font-family: 'Orbitron', monospace; font-size: 14px; font-weight: 900;
            background: linear-gradient(135deg, #00ff00 0%, #0066ff 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-transform: uppercase; letter-spacing: 1.2px;
        }
        .symbol-selector { position: relative; }
        .current-symbol {
            background: rgba(0,0,0,0.8); border: 2px solid rgba(0,255,0,0.3); color: #00ff00;
            padding: 6px 30px 6px 12px; border-radius: 8px; font-family: 'Orbitron', monospace;
            font-size: 12px; font-weight: 700; cursor: pointer; position: relative; min-width: 120px;
        }
        .current-symbol::after {
            content: 'â–¼'; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-size: 8px;
        }
        .symbol-dropdown {
            position: absolute; top: 100%; right: 0; background: rgba(0,0,0,0.98);
            border: 2px solid rgba(0,255,0,0.5); border-radius: 8px; margin-top: 8px;
            min-width: 200px; display: none; z-index: 1000; box-shadow: 0 8px 32px rgba(0,255,0,0.3);
        }
        .symbol-dropdown.show { display: block; }
        .symbol-option {
            padding: 10px 12px; cursor: pointer; border-bottom: 1px solid rgba(0,255,0,0.1); transition: all 0.3s;
        }
        .symbol-option:last-child { border-bottom: none; }
        .symbol-option:hover { background: rgba(0,255,0,0.1); }
        .symbol-option.active { background: rgba(0,255,0,0.2); border-left: 3px solid #00ff00; }
        .symbol-name {
            font-family: 'Orbitron', monospace; font-size: 11px; font-weight: 700;
            color: #00ff00; margin-bottom: 2px;
        }
        .symbol-desc { font-size: 9px; color: rgba(0,255,0,0.6); }
        .control-bar {
            display: flex; justify-content: center; align-items: center; gap: 2px;
            padding: 4px 0; flex-wrap: wrap;
        }
        .timeframe-ring {
            display: flex; gap: 2px; background: rgba(0,0,0,0.4); padding: 2px;
            border-radius: 15px; border: 1px solid rgba(0,255,0,0.15);
        }
        .timeframe-btn {
            padding: 3px 8px; background: rgba(0,0,0,0.8); border: 1px solid rgba(0,255,0,0.2);
            color: rgba(0,255,0,0.7); border-radius: 12px; font-size: 8px; font-weight: 700;
            cursor: pointer; white-space: nowrap; transition: all 0.3s; font-family: 'Orbitron', monospace;
            min-width: 28px; text-align: center;
        }
        .timeframe-btn:hover {
            background: rgba(0,255,0,0.1); border-color: rgba(0,255,0,0.5);
        }
        .timeframe-btn.active {
            background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
            color: #000; border-color: #00ff00; box-shadow: 0 0 12px rgba(0,255,0,0.4); transform: scale(1.05);
        }
        .chart-container {
            flex: 1; position: relative; background: rgba(0,0,0,0.5); overflow: hidden; min-height: 0;
        }
        #chartCanvas {
            width: 100%; height: 100%; display: block; touch-action: none;
        }
        .welcome-message {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; z-index: 10; padding: 20px;
        }
        .welcome-icon { font-size: 64px; margin-bottom: 20px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .welcome-text {
            font-family: 'Orbitron', monospace; font-size: 24px; font-weight: 900;
            background: linear-gradient(135deg, #00ff00 0%, #0066ff 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 15px;
        }
        .welcome-subtext { font-size: 14px; color: rgba(0,255,0,0.6); margin-bottom: 25px; }
        .symbol-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;
            max-width: 400px; margin: 0 auto;
        }
        .symbol-card {
            background: linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(0,50,0,0.9) 100%);
            border: 2px solid rgba(0,255,0,0.3); border-radius: 12px; padding: 20px;
            cursor: pointer; transition: all 0.3s; text-align: center;
        }
        .symbol-card:hover {
            border-color: #00ff00; box-shadow: 0 0 30px rgba(0,255,0,0.4); transform: translateY(-5px);
        }
        .symbol-card-icon { font-size: 32px; margin-bottom: 10px; }
        .symbol-card-name {
            font-family: 'Orbitron', monospace; font-size: 16px; font-weight: 900;
            color: #00ff00; margin-bottom: 5px;
        }
        .symbol-card-desc { font-size: 11px; color: rgba(0,255,0,0.6); }
        .loading-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100;
        }
        .loading-overlay.hidden { display: none; }
        .spinner {
            width: 50px; height: 50px; border: 3px solid rgba(0,255,0,0.2);
            border-top-color: #00ff00; border-radius: 50%; animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text {
            margin-top: 20px; font-family: 'Orbitron', monospace; color: #00ff00; font-size: 14px;
        }
        .connection-status {
            margin-top: 10px; font-size: 11px; font-family: 'Orbitron', monospace;
            padding: 6px 12px; border-radius: 6px; background: rgba(0,0,0,0.8);
        }
        .connection-status.trying { color: #FFB74D; border: 1px solid #FFB74D; }
        .connection-status.connected { color: #00ff00; border: 1px solid #00ff00; }
        .connection-status.failed { color: #ff0000; border: 1px solid #ff0000; }
        .price-info {
            position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.9);
            padding: 10px 15px; border-radius: 8px; border: 1px solid rgba(0,255,0,0.3); display: none;
        }
        .price-info.show { display: block; }
        .current-price {
            font-family: 'Orbitron', monospace; font-size: 18px; font-weight: 900; color: #00ff00;
        }
        .price-change { font-size: 11px; margin-top: 4px; }
        .price-change.up { color: #00ff00; }
        .price-change.down { color: #ff0000; }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div class="header-top">
                <div class="logo">MZANZI FX</div>
                <div class="symbol-selector">
                    <div class="current-symbol" onclick="toggleSymbolDropdown()" id="currentSymbol">Select Pair</div>
                    <div class="symbol-dropdown" id="symbolDropdown">
                        <div class="symbol-option" onclick="selectSymbol('XAUUSD')">
                            <div class="symbol-name">ðŸ¥‡ XAUUSD</div>
                            <div class="symbol-desc">Gold / US Dollar</div>
                        </div>
                        <div class="symbol-option" onclick="selectSymbol('BTCUSD')">
                            <div class="symbol-name">â‚¿ BTCUSD</div>
                            <div class="symbol-desc">Bitcoin / US Dollar</div>
                        </div>
                        <div class="symbol-option" onclick="selectSymbol('GBPUSD')">
                            <div class="symbol-name">ðŸ’· GBPUSD</div>
                            <div class="symbol-desc">British Pound / US Dollar</div>
                        </div>
                        <div class="symbol-option" onclick="selectSymbol('EURUSD')">
                            <div class="symbol-name">ðŸ’¶ EURUSD</div>
                            <div class="symbol-desc">Euro / US Dollar</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="control-bar">
                <div class="timeframe-ring">
                    <button class="timeframe-btn" onclick="changeTimeframe(60)">M1</button>
                    <button class="timeframe-btn active" onclick="changeTimeframe(300)">M5</button>
                    <button class="timeframe-btn" onclick="changeTimeframe(900)">M15</button>
                    <button class="timeframe-btn" onclick="changeTimeframe(1800)">M30</button>
                    <button class="timeframe-btn" onclick="changeTimeframe(3600)">H1</button>
                    <button class="timeframe-btn" onclick="changeTimeframe(14400)">H4</button>
                    <button class="timeframe-btn" onclick="changeTimeframe(86400)">D1</button>
                </div>
            </div>
        </div>
        <div class="chart-container">
            <div class="loading-overlay hidden" id="loadingOverlay">
                <div class="spinner"></div>
                <div class="loading-text">Loading chart data...</div>
                <div class="connection-status trying" id="connectionStatus">Connecting to Deriv...</div>
            </div>
            <div class="price-info" id="priceInfo">
                <div class="current-price" id="currentPrice">--</div>
                <div class="price-change" id="priceChange">--</div>
            </div>
            <div class="welcome-message" id="welcomeMessage">
                <div class="welcome-icon">ðŸ“Š</div>
                <div class="welcome-text">FOREX TRADING</div>
                <div class="welcome-subtext">Select your trading pair</div>
                <div class="symbol-grid">
                    <div class="symbol-card" onclick="selectSymbol('XAUUSD')">
                        <div class="symbol-card-icon">ðŸ¥‡</div>
                        <div class="symbol-card-name">XAUUSD</div>
                        <div class="symbol-card-desc">Gold</div>
                    </div>
                    <div class="symbol-card" onclick="selectSymbol('BTCUSD')">
                        <div class="symbol-card-icon">â‚¿</div>
                        <div class="symbol-card-name">BTCUSD</div>
                        <div class="symbol-card-desc">Bitcoin</div>
                    </div>
                    <div class="symbol-card" onclick="selectSymbol('GBPUSD')">
                        <div class="symbol-card-icon">ðŸ’·</div>
                        <div class="symbol-card-name">GBPUSD</div>
                        <div class="symbol-card-desc">British Pound</div>
                    </div>
                    <div class="symbol-card" onclick="selectSymbol('EURUSD')">
                        <div class="symbol-card-icon">ðŸ’¶</div>
                        <div class="symbol-card-name">EURUSD</div>
                        <div class="symbol-card-desc">Euro</div>
                    </div>
                </div>
            </div>
            <canvas id="chartCanvas"></canvas>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        const SYMBOL_CONFIG = {
            'XAUUSD': { name: 'GOLD (XAU/USD)', apiSymbol: 'frxXAUUSD' },
            'BTCUSD': { name: 'BITCOIN (BTC/USD)', apiSymbol: 'cryBTCUSD' },
            'GBPUSD': { name: 'GBP/USD', apiSymbol: 'frxGBPUSD' },
            'EURUSD': { name: 'EUR/USD', apiSymbol: 'frxEURUSD' }
        };

        let currentSymbol = null;
        let currentTimeframe = 300;
        let ws = null;
        let chartData = [];
        let canvas = null;
        let ctx = null;

        function toggleSymbolDropdown() {
            document.getElementById('symbolDropdown').classList.toggle('show');
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.symbol-selector')) {
                document.getElementById('symbolDropdown').classList.remove('show');
            }
        });

        function selectSymbol(symbol) {
            currentSymbol = symbol;
            document.getElementById('currentSymbol').textContent = symbol;
            document.getElementById('symbolDropdown').classList.remove('show');
            document.getElementById('welcomeMessage').style.display = 'none';
            document.getElementById('priceInfo').classList.add('show');
            document.getElementById('loadingOverlay').classList.remove('hidden');
            
            canvas = document.getElementById('chartCanvas');
            ctx = canvas.getContext('2d');
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
            
            connectToData(symbol, currentTimeframe);
        }

        function connectToData(symbol, timeframe) {
            if (ws) ws.close();
            
            chartData = [];
            const apiSymbol = SYMBOL_CONFIG[symbol].apiSymbol;
            
            ws = new WebSocket('wss://ws.derivws.com/websockets/v3?app_id=1089');
            
            ws.onopen = () => {
                document.getElementById('connectionStatus').className = 'connection-status connected';
                document.getElementById('connectionStatus').textContent = 'âœ“ Connected: Deriv';
                
                ws.send(JSON.stringify({ 
                    ticks: apiSymbol, 
                    subscribe: 1 
                }));
                
                ws.send(JSON.stringify({
                    ticks_history: apiSymbol,
                    count: 1000,
                    end: 'latest',
                    style: 'candles',
                    granularity: timeframe
                }));
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                
                if (data.candles) {
                    chartData = data.candles.map(c => ({
                        x: c.epoch * 1000,
                        o: parseFloat(c.open),
                        h: parseFloat(c.high),
                        l: parseFloat(c.low),
                        c: parseFloat(c.close)
                    }));
                    drawChart();
                    updatePriceInfo();
                    setTimeout(() => {
                        document.getElementById('loadingOverlay').classList.add('hidden');
                    }, 1000);
                } else if (data.tick) {
                    updateTick(parseFloat(data.tick.quote), data.tick.epoch * 1000);
                } else if (data.ohlc) {
                    const candle = data.ohlc;
                    updateCandle({
                        x: candle.epoch * 1000,
                        o: parseFloat(candle.open),
                        h: parseFloat(candle.high),
                        l: parseFloat(candle.low),
                        c: parseFloat(candle.close)
                    });
                }
            };

            ws.onerror = () => {
                document.getElementById('connectionStatus').className = 'connection-status failed';
                document.getElementById('connectionStatus').textContent = 'âœ— Connection Failed';
            };
        }

        function updateTick(price, time) {
            const candleStart = Math.floor(time / (currentTimeframe * 1000)) * (currentTimeframe * 1000);
            
            if (!chartData.length || candleStart > chartData[chartData.length - 1].x) {
                chartData.push({ x: candleStart, o: price, h: price, l: price, c: price });
                if (chartData.length > 1000) chartData.shift();
            } else {
                const last = chartData[chartData.length - 1];
                last.c = price;
                last.h = Math.max(last.h, price);
                last.l = Math.min(last.l, price);
            }
            
            drawChart();
            updatePriceInfo();
        }

        function updateCandle(candle) {
            if (!chartData.length) return;
            
            const last = chartData[chartData.length - 1];
            if (candle.x === last.x) {
                chartData[chartData.length - 1] = candle;
            } else {
                chartData.push(candle);
                if (chartData.length > 1000) chartData.shift();
            }
            
            drawChart();
            updatePriceInfo();
        }

        function drawChart() {
            if (!chartData.length || !canvas) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const padding = { top: 20, right: 60, bottom: 20, left: 10 };
            const chartW = canvas.width - padding.left - padding.right;
            const chartH = canvas.height - padding.top - padding.bottom;
            
            const zoom = 80;
            const candlesPerScreen = Math.floor(zoom);
            const visible = chartData.slice(-candlesPerScreen);
            
            if (!visible.length) return;
            
            const prices = visible.flatMap(c => [c.h, c.l]);
            const maxP = Math.max(...prices);
            const minP = Math.min(...prices);
            const range = maxP - minP || 0.01;
            const buffer = range * 0.05;
            
            const priceToY = (price) => {
                return padding.top + chartH - ((price - (minP - buffer)) / (range + 2 * buffer)) * chartH;
            };
            
            const candleW = chartW / candlesPerScreen;
            const wickW = Math.max(1, candleW * 0.1);
            const bodyW = Math.max(2, candleW * 0.8);
            
            // Draw candles
            visible.forEach((candle, i) => {
                const x = padding.left + i * candleW + candleW / 2;
                const isGreen = candle.c >= candle.o;
                
                ctx.strokeStyle = isGreen ? '#26a69a' : '#ef5350';
                ctx.lineWidth = wickW;
                ctx.beginPath();
                ctx.moveTo(x, priceToY(candle.h));
                ctx.lineTo(x, priceToY(candle.l));
                ctx.stroke();
                
                const yTop = priceToY(Math.max(candle.o, candle.c));
                const yBottom = priceToY(Math.min(candle.o, candle.c));
                const bodyHeight = Math.max(1, yBottom - yTop);
                
                ctx.fillStyle = isGreen ? '#26a69a' : '#ef5350';
                ctx.fillRect(x - bodyW / 2, yTop, bodyW, bodyHeight);
            });
            
            // Draw price scale
            const steps = 6;
            const priceStep = (maxP + buffer - (minP - buffer)) / steps;
            
            ctx.fillStyle = '#8E8E93';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'right';
            
            for (let i = 0; i <= steps; i++) {
                const price = minP - buffer + i * priceStep;
                const y = padding.top + chartH - (i / steps) * chartH;
                
                const precision = getPrecision(chartData[chartData.length - 1].c);
                ctx.fillText(price.toFixed(precision), canvas.width - padding.right + 55, y + 4);
                
                ctx.strokeStyle = 'rgba(142, 142, 147, 0.08)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(canvas.width - padding.right, y);
                ctx.stroke();
            }
        }

        function updatePriceInfo() {
            if (chartData.length < 2) return;
            
            const current = chartData[chartData.length - 1];
            const prev = chartData[chartData.length - 2];
            const change = ((current.c - prev.c) / prev.c) * 100;
            const precision = getPrecision(current.c);
            
            document.getElementById('currentPrice').textContent = current.c.toFixed(precision);
            const changeEl = document.getElementById('priceChange');
            changeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
            changeEl.className = 'price-change ' + (change >= 0 ? 'up' : 'down');
        }

        function getPrecision(price) {
            if (price < 1) return 5;
            if (price < 100) return 4;
            if (price < 1000) return 3;
            return 2;
        }

        function changeTimeframe(tf) {
            currentTimeframe = tf;
            document.querySelectorAll('.timeframe-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            if (currentSymbol) {
                document.getElementById('loadingOverlay').classList.remove('hidden');
                connectToData(currentSymbol, tf);
            }
        }

        window.addEventListener('resize', () => {
            if (canvas && currentSymbol) {
                canvas.width = canvas.parentElement.clientWidth;
                canvas.height = canvas.parentElement.clientHeight;
                drawChart();
            }
        });
    </script>
</body>
</html>
